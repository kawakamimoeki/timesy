<!DOCTYPE html>
<html lang="ja">
  <head>
    <%= display_meta_tags(default_meta_tags)%>
    <meta name="description" content="<%= Site.description %>">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "tailwind", "inter-font", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@3.0.1/github-markdown.min.css">
    <link rel="stylesheet"
        href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/themes/light.css" />
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/backdrop.css" />
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/animations/shift-away.css" />

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="stylesheet" type="text/css" href="/dracula.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
      hljs.highlightAll();
      const mo = new MutationObserver(() => {
        hljs.highlightAll();
      })
      mo.observe(document.documentElement, { childList: true });
      document.documentElement.addEventListener('turbo:frame-render', () => {
        hljs.highlightAll();
      })
    </script>
    <script>window.twttr = (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0],
        t = window.twttr || {};
      if (d.getElementById(id)) return t;
      js = d.createElement(s);
      js.id = id;
      js.src = "https://platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js, fjs);

      t._e = [];
      t.ready = function(f) {
        t._e.push(f);
      };

      return t;
    }(document, "script", "twitter-wjs"));</script>
  </head>

  <body class="bg-background bg-cover bg-fixed dark:bg-dark-background" data-controller="wallpaper" data-wallpaper-url-value="<%= current_user&.wallpaper_url %>">
    <script>
      if (localStorage.theme === 'dark') {
        document.querySelector("body").classList.add('dark')
      } else {
        document.querySelector("body").classList.remove('dark')
      }
    </script>
    <header class="w-full bg-white dark:bg-dark-background dark:text-gray-200 border-b dark:border-dark-border">
      <div class="flex max-w-3xl mx-auto px-4 items-center py-3 text-sm">
        <%= link_to "/", class: "block mr-3" do %>
          <span class="dark:hidden">
            <img src="<%= "/logo.png" %>" alt="logo" width="70px" height="20px" />
          </span>
          <span class="hidden dark:block">
            <img src="<%= "/logo-dark.png" %>" alt="logo" width="70px" height="20px" />
          </span>
        <% end %>
        <div class="grow"></div>
        <div data-controller="theme" class="mr-1">
          <button data-action="theme#toggle" data-theme-target="dark" class="hidden <%= icon_button_class %>">
            <%= image_tag "icons/light.svg", width: "24px", height: "16px",class: "icon" %>
          </button>
          <button data-action="theme#toggle" data-theme-target="light" class="hidden <%= icon_button_class %>">
            <%= image_tag "icons/dark.svg", width: "24px", height: "16px",class: "icon" %>
          </button>
        </div>
        <% if current_user %>
          <div class="overflow-visible mr-3 relative" data-controller="notification">
            <button
              data-action="click->notification#toggle click->notification#read"
              class="relative <%= icon_button_class %>"
              data-turbo-frame="notifications"
            >
              <%= image_tag "icons/notification.svg", width: "24px", height: "16px",class: "icon" %>
              <div data-notification-target="indicator" class="hidden absolute top-2 right-2 w-2 h-2 rounded-full bg-red-500 text-white text-xs items-center justify-center"></div>
            </button>
            <div
              data-notification-target="dropdown"
              class="<%= dropdown_class %> max-h-96 overflow-scroll">
              <%= turbo_stream_from "notifications-for-#{current_user.id}" %>
              <%= turbo_frame_tag :notifications, src: notifications_path do %>
              <% end %>
            </div>
            <div data-action="click->notification#toggle" data-notification-target="backdrop" class="<%= backdrop_class %>"></div>
          </div>
        <% end %>
        <% if !current_user %>
          <%= link_to I18n.t("users.sign_in"), "/users/sign_in", class: "mr-2 rounded hover:bg-gray-50 dark:hover:bg-gray-700 py-1 px-2" %>
          <%= link_to I18n.t("users.sign_up"), "/users/sign_up", class: primary_button_class %>
        <% end %>
        <div data-controller="menu" class="-mb-[4px] overflow-visible relative">
          <% if current_user %>
            <button data-action="click->menu#toggle">
              <%= image_tag current_user.avatar_icon, alt: current_user.username, class: "w-8 h-8 object-cover rounded-full" %>
            </button>
          <% else %>
            <button data-action="click->menu#toggle" class="<%= icon_button_class %> ml-1">
              <%= image_tag "icons/menu.svg", width: "24px", height: "16px",class: "icon" %>
            </button>
          <% end %>
          <div data-action="click->menu#toggle" data-menu-target="backdrop" class="<%= backdrop_class %>"></div>
          <div class="<%= dropdown_class %>"  data-menu-target="dropdown">
            <div class="text-sm h-full w-full p-4 dark:border-dark-border">
              <ul class="flex flex-col space-y-1">
                <% if current_user %>
                <li>
                  <%= link_to I18n.t("pages.follow"), root_path, class: "#{request.path === root_path ? "font-bold" : ""} #{block_link_class}" %>
                </li>
                <% end %>
                <li>
                  <%= link_to I18n.t("pages.latest"), latest_path, class: "#{request.path === latest_path ? "font-bold" : ""} #{block_link_class}" %>
                </li>
                <% if current_user %>
                <li>
                  <%= link_to I18n.t("pages.your_posts"), user_path(current_user.username), class: "#{request.path === user_path(current_user.username) ? "font-bold" : ""} #{block_link_class}" %>
                </li>
                <li>
                  <%= link_to I18n.t("pages.your_comments"), user_comments_path(current_user.username), class: "#{request.path === user_comments_path(current_user.username) ? "font-bold" : ""} #{block_link_class}" %>
                </li>
                <li>
                  <%= link_to I18n.t("pages.your_projects"), projects_path(current_user.username), class: "#{request.path === projects_path(current_user.username) ? "font-bold" : ""} #{block_link_class}" %>
                </li>
                <li>
                  <%= link_to I18n.t("pages.settings"), settings_path, class: "#{request.path === settings_path ? "font-bold" : ""} #{block_link_class}" %>
                </li>
                <li class="w-full dark:border-dark-border border-b pb-2"></li>
                <li class="w-full pb-2"></li>
                <% end %>
                <li>
                  <%= link_to I18n.t("pages.docs"), docs_path, class: "#{request.path === docs_path ? "font-bold" : ""} #{block_link_class}" %>
                </li>
                <li>
                  <%= link_to I18n.t("pages.about"), about_path, class: "#{request.path === about_path ? "font-bold" : ""} #{block_link_class}" %>
                </li>
                <li>
                  <%= link_to I18n.t("pages.terms"), terms_path, class: "#{request.path === terms_path ? "font-bold" : ""} #{block_link_class}" %>
                </li>
                <li>
                  <%= link_to I18n.t("pages.privacy"), privacy_path, class: "#{request.path === privacy_path ? "font-bold" : ""} #{block_link_class}" %>
                </li>
                <li>
                  <%= link_to "https://forms.gle/7FZz2iHzYLQYiom7A", class: " #{block_link_class}" do %>
                    <span><%= I18n.t("pages.emoji_request") %></span>
                  <% end %>
                </li>
                <li>
                  <%= link_to "https://github.com/moekidev/timesy", class: " #{block_link_class}" do %>
                    <span><%= I18n.t("pages.github") %></span>
                  <% end %>
                </li>
                <li>
                  <%= link_to "https://status.timesy.dev/", class: " #{block_link_class}" do %>
                    <span><%= I18n.t("pages.status") %></span>
                  <% end %>
                </li>
                <li>
                  <%= link_to "https://www.buymeacoffee.com/moekidev", class: " #{block_link_class}" do %>
                    <span><%= I18n.t("pages.tip") %></span>
                  <% end %>
                </li>
              </ul>
            </div>
          </div>
        </div>
      <div>
    </header>

    <main class="flex items-stretch">
      <%= yield %>
      <%= turbo_frame_tag "twitter_script" do %>
        <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
      <% end %>
    </main>

    <% if request.path.match?("posts") || request.path.in?([settings_path, about_path, docs_path, terms_path, privacy_path]) %>
    <div class="w-full px-4 mx-auto max-w-3xl">
    <footer class="flex leading-5 justify-center items-center mb-12 text-xs text-gray-500 flex-wrap bg-background dark:bg-dark-background rounded-lg p-3">
      <%= link_to I18n.t("pages.docs"), docs_path %>・
      <%= link_to I18n.t("pages.about"), about_path %>・
      <%= link_to I18n.t("pages.terms"), terms_path %>・
      <%= link_to I18n.t("pages.privacy"), privacy_path %>・
      <%= link_to I18n.t("pages.emoji_request"), "https://forms.gle/7FZz2iHzYLQYiom7A" %>・
      <%= link_to I18n.t("pages.github"), "https://github.com/moekidev/timesy" %>・
      <%= link_to I18n.t("pages.status"), "https://status.timesy.dev/" %>・
      <%= link_to I18n.t("pages.tip"), "https://www.buymeacoffee.com/moekidev" %>
    </footer>
    </div>
    <% end %>
  </body>
</html>
