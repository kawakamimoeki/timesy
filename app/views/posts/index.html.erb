<div class="max-w-3xl mx-auto">
  <div class="flex items-center px-5">
    <h1 class="font-bold text-3xl">Latest</h1>
    <div class="grow"></div>
    <div class="flex items-center shadow rounded">
      <%= link_to I18n.t("posts.all"), root_path, class: "#{@dev ? "bg-white border-white" : "border-sky-500 bg-sky-500 text-white"} text-sm py-1 px-3 border m-0 rounded-s w-[60px] block text-center" %>
      <%= link_to I18n.t("posts.dev"), root_path(dev: true), class: "#{!@dev ? "bg-white border-white" : "bg-sky-500 text-white border-sky-500"} text-sm py-1 px-3 border w-[60px] text-center m-0 rounded-e block" %>
    </div>
  </div>
  <div class="py-5">
    <% if current_user %>
    <div class="flex w-full bg-white p-5 text-gray-700 border-b">
      <div class="transition-all">
        <%= link_to user_path(username: current_user.username), class: "w-10 flex items-center space-x-1 hover:underline mt-1" do %>
          <%= image_tag current_user.avatar_icon, alt: current_user.username, width: "50px", height: "50px", class: "w-10 h-10 object-cover rounded-full" %>
        <% end %>
      </div>
      <%= form_with model: @post, url: create_post_path, data: { action: "turbo:submit-end->turbo-form#clear turbo:submit-end->markdown#clear", turbo_frame: :posts, controller: "turbo-form markdown", post_editor_confirm_message: I18n.t("page.confirm_leave"),  markdown_min_height_value: "100px", markdown_placeholder_value: I18n.t("posts.placeholder") }, class: "grow transition-all" do |f| %>
        <div>
          <%= flash[:error] %>
          <%= f.hidden_field :page, value: @page %>
          <div class="max-w-3xl mx-auto">
            <div class="bg-white">
              <div data-markdown-target="editorContainer">
                <%= f.text_area :body, data: { markdown_target: "editor" }, class: "prose min-h-[115px] resize-none" %>
              </div>
              <div class="markdown-body hidden px-5 min-h-[100px]" data-markdown-target="preview"></div>
            </div>
          </div>
        </div>
        <div class="flex pt-3 w-full items-center bg-white px-5">
          <div class="grow"></div>
          <%= f.label :dev, class: "text-sm cursor-pointer flex items-center" do %>
            <%= f.check_box :dev, checked: @dev, class: "mr-2" %>
            <%= I18n.t("posts.to_dev") %>
          <% end %>
          <div class="px-1">
            <button type="button" class="rounded-full p-relative p-2 hover:bg-gray-50 transition-all" title="<%=  I18n.t('posts.preview') %>" data-action="markdown#preview" data-markdown-target="previewButton">
              <%= image_tag "icons/preview.svg", alt: "preview", class: "w-6 h-6" %>
            </button>
            <button type="button" class="rounded-full p-relative p-2 hover:bg-gray-50 transition-all hidden" title="<%=  I18n.t('posts.edit') %>" data-action="markdown#edit" data-markdown-target="editorButton">
              <%= image_tag "icons/edit.svg", alt: "edit", class: "w-6 h-6" %>
            </button>
          </div>
          <div class="px-1">
            <%= f.submit I18n.t('posts.publish'), disabled: true, class: primary_button_class, data: { post_editor_target: "publish" } %>
          </div>
        </div>
      <% end %>
    </div>
    <% end %>
    <% if @posts.empty? %>
      <p class="w-full text-center py-16 font-bold"><%= I18n.t("posts.not_found") %></p>
    <% end %>
    <%= turbo_frame_tag :posts do %>
      <%= render partial: 'posts/item', collection: @posts %>
    <% end %>

    <%= turbo_frame_tag "load_more", src: root_path(dev: params[:dev], format: :turbo_stream, page: 1), loading: :lazy  %>
  </div>
</div>
