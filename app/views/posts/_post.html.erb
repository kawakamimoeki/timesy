<div id="post_<%= post.id %>" class="<%= "#{card_class} #{defined?(additional_class) ? additional_class : ''}" %>" data-controller="post-show" data-testid="<%= post.body %>" >
  <div class="mb-4">
    <div class="flex flex-col-reverse sm:flex-row mb-3 items-start space-x-1">
      <div class="flex items-center space-x-1 flex-wrap">
        <%= render partial: "shared/avatar", locals: { user: post.user } %>
        <time class="text-gray-400 text-sm"><%= time_ago_in_words(post.created_at) %></time>
      </div>
      <div class="grow flex items-center space-x-1 w-full sm:w-auto">
        <div class="grow"></div>
        <button class="<%= icon_button_class %>"  data-controller="copy tooltip" data-copy-copied-text-value="<%= I18n.t("clipboard.copied") %>" data-tooltip-text-value="<%= I18n.t("posts.copy-markdown") %>" data-copy-content-value="<%= post.body %>">
          <div class="i-lucide-copy"></div>
        </button>
        <button class="<%= icon_button_class %>"  data-controller="copy tooltip" data-copy-copied-text-value="<%= I18n.t("clipboard.copied") %>" data-tooltip-text-value="<%= I18n.t("posts.copy-link") %>" data-copy-content-value="<%= post_url(post) %>">
          <div class="i-lucide-link"></div>
        </button>
        <%= turbo_frame_tag "pin_button_container", src: post_pin_button_path(post), data: { post_show_target: "menu" } %>
        <%= turbo_frame_tag "post_editor-#{post.id}", src: post_editor_path(post) %>
      </div>
    </div>
    <%= turbo_frame_tag :post do %>
      <div data-post-show-target="show" data-controller="image-modal twitter" class="markdown-body">
        <%= post.html.html_safe %>
      </div>
    <% end %>
    <div class="hidden" data-post-show-target="editor">
      <%= form_with(
        model: post,
        url: update_post_path(id: post.id),
        id: "post-form",
        data: {
          action: "turbo:submit-end->post-show#close",
          turbo_frame: :post,
          controller: "turbo-form markdown",
          post_editor_confirm_message: I18n.t("page.confirm_leave"),
          markdown_min_height_value: "100px",
          markdown_model_value: "post",
          markdown_placeholder_value: I18n.t("posts.placeholder"),
          markdown_image_uploading_text_value: I18n.t("images.uploading"),
          markdown_image_upload_failed_text_value: I18n.t("images.upload_failed")
        },
        class: "grow transition-all"
      ) do |f| %>
        <div>
          <%= flash[:error] %>
          <div class="max-w-3xl mx-auto">
            <div class="">
              <div data-markdown-target="editorContainer">
                <%= f.text_area :body, data: { markdown_target: "editor", post_editor_target: "body" }, class: "prose resize-none min-h-[114px]" %>
              </div>
              <div class="markdown-body hidden min-h-[120px]" data-markdown-target="preview"></div>
            </div>
          </div>
        </div>
        <div class="flex pt-3 w-full items-center bg-none">
          <div class="grow"></div>
          <div class="px-1">
            <button
              type="button"
              class="<%= icon_button_class %>"
              title="<%=  I18n.t('posts.preview') %>(âŒ˜+Shift+P)"
              data-controller="tooltip"
              data-tooltip-text-value="<%= I18n.t('posts.image') %>"
              data-action="markdown#attachImage"
              data-testid="attach-image"
            >
              <div class="i-lucide-image"></div>
            </button>
          </div>
          <div class="px-1">
            <button type="button" class="<%= icon_button_class %>" title="<%=  I18n.t('posts.preview') %>" data-action="markdown#preview" data-markdown-target="previewButton" >
              <div class="i-lucide-eye"></div>
            </button>
            <button type="button" class="<%= icon_button_class %> hidden" title="<%=  I18n.t('posts.edit') %>" data-action="markdown#edit" data-markdown-target="editorButton" >
              <div class="i-lucide-pen"></div>
            </button>
          </div>
          <div class="ml-2">
            <%= f.submit I18n.t('posts.update'), disabled: true, class: primary_button_class, data: { post_editor_target: "publish" } %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  <% if post.comments.count > 0 %>
    <div class="text-xs flex items-center">
      <%= image_tag post.user.avatar_icon, class: "w-4 h-4 rounded-full mr-1" %>
      <p class="opacity-70"><%= post.comments.latest&.first&.truncated(32) %></p>
    </div>
  <% end %>
  <div class="flex items-end">
    <div class="flex grow items-center flex-wrap w-[calc(100%-40px)]">
      <div class="flex items-center flex-wrap overflow-hidden mr-2">
        <%= turbo_frame_tag "post_reactions_list-#{post.id}", src: post_reactions_path(post), class: "flex items-center flex-wrap" %>
      </div>
      <div class="flex items-center">
        <% if post.comments.count > 0 %>
        <div class="<%= indicator_class %>">
          <span class="i-lucide-server mr-1"></span>
          <%= post.comments.count %>
        </div>
        <% end %>
        <% if post.cheers.count > 0 %>
          <div class="<%= indicator_class %>">
            <span class="i-lucide-message-circle mr-1"></span>
            <%= post.cheers.count %>
          </div>
        <% end %>
      </div>
    </div>
    <% if request.path.exclude? "posts" %>
      <%= link_to post_path(post.id), class: icon_button_class do %>
        <div class="i-lucide-arrow-right"></div>
      <% end %>
    <% end %>
  </div>
</div>
